<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutor de Espa침ol con Gemini</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        .container {
            text-align: center;
            position: relative;
        }

        .brain-button {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(145deg, #8e2de2, #4a00e0);
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 90px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            user-select: none;
            position: relative;
            z-index: 10;
        }

        .brain-button:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        .brain-button:active {
            transform: scale(0.98);
        }

        .listening {
            animation: pulse 0.3s infinite alternate;
            background: linear-gradient(145deg, #ff416c, #ff4b2b);
        }

        @keyframes pulse {
            from {
                transform: scale(1);
                box-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
            }
            to {
                transform: scale(1.15);
                box-shadow: 0 0 50px rgba(255, 255, 255, 1);
            }
        }

        .status {
            margin-top: 40px;
            color: white;
            font-size: 22px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
            min-height: 30px;
            font-weight: 500;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px 20px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
        }

        .waves {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: wave 2s infinite;
            pointer-events: none;
        }

        .waves.listening {
            display: block;
        }

        @keyframes wave {
            0% {
                width: 250px;
                height: 250px;
                opacity: 1;
            }
            100% {
                width: 400px;
                height: 400px;
                opacity: 0;
            }
        }

        .footer {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
        }

        .hidden {
            display: none;
        }

        .error {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }

        .success {
            color: #51cf66;
            background: rgba(81, 207, 102, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="brain-button" id="brainButton">游</button>
        <div class="waves" id="waves"></div>
        <div class="status" id="status">Presiona el cerebro para hablar</div>
    </div>
    
    <div class="footer">
        Tutor de Espa침ol - Desarrollado por Rafael
    </div>

    <script>
        // Elementos del DOM
        const brainButton = document.getElementById('brainButton');
        const status = document.getElementById('status');
        const waves = document.getElementById('waves');
        
        // Variables globales
        const API_KEY = "AIzaSyAjt15fLEcxsXkGeZjBpu0BHKOt1HI6Gxs";
        let recognition = null;
        let synthesis = null;
        let isListening = false;
        
        // Inicializaci칩n
        document.addEventListener('DOMContentLoaded', function() {
            initializeSpeechRecognition();
            initializeSpeechSynthesis();
        });
        
        // Configurar reconocimiento de voz
        function initializeSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showError("Tu navegador no soporta reconocimiento de voz");
                brainButton.disabled = true;
                return;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            // Configuraci칩n mejorada
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'es-ES';
            recognition.maxAlternatives = 1;
            
            // Eventos
            recognition.onstart = function() {
                isListening = true;
                status.textContent = "Escuchando... habla ahora";
                status.className = "status success";
                brainButton.classList.add('listening');
                waves.style.display = 'block';
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                status.textContent = `Pregunta: "${transcript}"`;
                brainButton.classList.remove('listening');
                waves.style.display = 'none';
                
                // Enviar a Gemini
                sendToGemini(transcript);
            };
            
            recognition.onerror = function(event) {
                isListening = false;
                brainButton.classList.remove('listening');
                waves.style.display = 'none';
                
                let errorMessage = "Error de reconocimiento: ";
                switch(event.error) {
                    case 'no-speech':
                        errorMessage = "No se detect칩 voz. Intenta de nuevo.";
                        break;
                    case 'audio-capture':
                        errorMessage = "No se pudo acceder al micr칩fono.";
                        break;
                    case 'not-allowed':
                        errorMessage = "Permiso de micr칩fono denegado.";
                        break;
                    default:
                        errorMessage = "Error: " + event.error;
                }
                
                showError(errorMessage);
                setTimeout(() => {
                    status.textContent = "Presiona el cerebro para hablar";
                    status.className = "status";
                }, 3000);
            };
            
            recognition.onend = function() {
                isListening = false;
                brainButton.classList.remove('listening');
                waves.style.display = 'none';
                
                if (status.textContent === "Escuchando... habla ahora") {
                    status.textContent = "No se detect칩 voz. Intenta de nuevo.";
                    status.className = "status error";
                    setTimeout(() => {
                        status.textContent = "Presiona el cerebro para hablar";
                        status.className = "status";
                    }, 3000);
                }
            };
        }
        
        // Configurar s칤ntesis de voz
        function initializeSpeechSynthesis() {
            if (!('speechSynthesis' in window)) {
                showError("Tu navegador no soporta s칤ntesis de voz");
                return;
            }
            
            synthesis = window.speechSynthesis;
        }
        
        // Event Listener para el bot칩n
        brainButton.addEventListener('click', function() {
            if (!recognition) {
                showError("Reconocimiento de voz no disponible");
                return;
            }
            
            if (isListening) {
                recognition.stop();
                return;
            }
            
            try {
                recognition.start();
            } catch (error) {
                showError("Error al iniciar reconocimiento: " + error.message);
            }
        });
        
        // Funci칩n para enviar consulta a Gemini
        async function sendToGemini(query) {
            status.textContent = "Procesando tu pregunta...";
            status.className = "status";
            
            try {
                // En una implementaci칩n real, aqu칤 har칤as la llamada a la API de Gemini
                const response = await callGeminiAPI(query);
                
                // Reproducir respuesta
                speakResponse(response);
                
            } catch (error) {
                let errorMessage;
                
                if (error.message.includes("cr칠ditos")) {
                    errorMessage = "Los cr칠ditos de uso se han agotado, contacta a Rafael para arreglarlo";
                } else {
                    errorMessage = "Error al conectar con Gemini: " + error.message;
                }
                
                showError(errorMessage);
                speakResponse(errorMessage);
            }
        }
        
        // Funci칩n para llamar a la API de Gemini (simulada)
        async function callGeminiAPI(query) {
            // Simulamos un retardo de red
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Verificar si la consulta est치 relacionada con el aprendizaje de espa침ol
            const spanishLearningKeywords = [
                'espa침ol', 'espanol', 'aprender', 'idioma', 'lengua', 'gram치tica', 'gramatica',
                'vocabulario', 'verbos', 'conjugaci칩n', 'conjugacion', 'pronunciaci칩n', 'pronunciacion',
                'ejercicio', 'pr치ctica', 'practica', 'lecci칩n', 'leccion', 'clase', 'profesor',
                'tutor', 'ense침ar', 'ensenar', 'traducir', 'traducci칩n', 'traduccion', 'palabra',
                'frase', 'oraci칩n', 'oracion', 'conversaci칩n', 'conversacion', 'hablar', 'escuchar',
                'leer', 'escribir', 'ejemplo', 'regla', 'explicaci칩n', 'explicacion', 'significado',
                'sin칩nimo', 'sinonimo', 'ant칩nimo', 'antonimo', 'acento', 'tilde', 'g칠nero', 'genero',
                'n칰mero', 'numero', 'singular', 'plural', 'tiempo', 'modo', 'indicativo', 'subjuntivo',
                'imperativo', 'pret칠rito', 'preterito', 'futuro', 'condicional', 'presente', 'pasado',
                'ser', 'estar', 'haber', 'tener', 'hacer', 'decir', 'ir', 'ver', 'dar', 'saber',
                'querer', 'llegar', 'pasar', 'deber', 'poner', 'parecer', 'quedar', 'creer', 'hablar',
                'llevar', 'dejar', 'seguir', 'encontrar', 'llamar', 'venir', 'pensar', 'salir', 'volver',
                'tomar', 'conocer', 'vivir', 'sentir', 'tratar', 'mirar', 'esperar', 'contar', 'empezar',
                'buscar', 'existir', 'entrar', 'trabajar', 'escribir', 'perder', 'producir', 'ocurrir',
                'entender', 'pedir', 'recibir', 'recordar', 'terminar', 'permitir', 'aparecer', 'conseguir',
                'comenzar', 'servir', 'sacar', 'necesitar', 'mantener', 'resultar', 'leer', 'caer', 'cambiar',
                'presentar', 'crear', 'abrir', 'considerar', 'o칤r', 'acabar', 'convertir', 'ganar', 'formar',
                'traer', 'partir', 'morir', 'aceptar', 'realizar', 'suponer', 'comprender', 'lograr',
                'explicar', 'preguntar', 'tocar', 'reconocer', 'estudiar', 'alcanzar', 'nacer', 'dirigir',
                'correr', 'utilizar', 'pagar', 'ayudar', 'gustar', 'jugar', 'escuchar', 'cumplir', 'ofrecer',
                'descubrir', 'levantar', 'intentar', 'usar', 'decidir', 'repetir', 'comer', 'mostrar'
            ];
            
            const lowerQuery = query.toLowerCase();
            const isRelatedToSpanish = spanishLearningKeywords.some(keyword => 
                lowerQuery.includes(keyword)
            );
            
            if (!isRelatedToSpanish) {
                return "Rafael program칩 la app como un tutor de espa침ol. Por favor, haz preguntas relacionadas con el aprendizaje del idioma espa침ol.";
            }
            
            // Respuestas espec칤ficas para diferentes tipos de preguntas
            if (lowerQuery.includes('hola') || lowerQuery.includes('buenos d칤as') || lowerQuery.includes('buenas tardes')) {
                return "춰Hola! Soy tu tutor de espa침ol. 쮼n qu칠 puedo ayudarte con tu aprendizaje del idioma hoy?";
            } else if (lowerQuery.includes('c칩mo') && lowerQuery.includes('estar')) {
                return "춰Estoy aqu칤 para ayudarte con el espa침ol! Como tutor de idiomas, mi prop칩sito es asistirte en tu aprendizaje. 쯈u칠 te gustar칤a practicar hoy?";
            } else if (lowerQuery.includes('verbo') || lowerQuery.includes('conjugaci칩n') || lowerQuery.includes('conjugacion')) {
                return "Los verbos en espa침ol se conjugan seg칰n el tiempo, modo, persona y n칰mero. Por ejemplo, el verbo 'hablar' en presente: yo hablo, t칰 hablas, 칠l habla. 쯊e gustar칤a que te explique alg칰n verbo en particular?";
            } else if (lowerQuery.includes('gram치tica') || lowerQuery.includes('gramatica')) {
                return "La gram치tica espa침ola incluye reglas sobre art칤culos, sustantivos, adjetivos, verbos y m치s. Un aspecto importante es la concordancia entre g칠nero y n칰mero. 쯈u칠 aspecto espec칤fico te interesa?";
            } else if (lowerQuery.includes('vocabulario') || lowerQuery.includes('palabra')) {
                return "Para expandir tu vocabulario en espa침ol, te recomiendo practicar con listas tem치ticas y usar las nuevas palabras en contexto. Por ejemplo, palabras relacionadas con la comida: manzana, pan, queso, leche. 쮿ay alguna palabra espec칤fica que quieras aprender?";
            } else if (lowerQuery.includes('pronunciaci칩n') || lowerQuery.includes('pronunciacion')) {
                return "La pronunciaci칩n en espa침ol es generalmente fon칠tica. Un sonido que puede ser dif칤cil para aprendices es la 'rr' vibrante, como en 'perro'. 쯊e gustar칤a que te ayude con la pronunciaci칩n de alg칰n sonido espec칤fico?";
            } else if (lowerQuery.includes('ejercicio') || lowerQuery.includes('pr치ctica') || lowerQuery.includes('practica')) {
                return "Para practicar espa침ol, te recomiendo ejercicios de completar espacios, conversaciones guiadas y escuchar contenido en espa침ol. Tambi칠n es 칰til leer en voz alta y grabarse para mejorar la pronunciaci칩n. 쯈u칠 tipo de ejercicio te gustar칤a hacer?";
            } else if (lowerQuery.includes('diferenci') || lowerQuery.includes('ser') || lowerQuery.includes('estar')) {
                return "Una duda com칰n es la diferencia entre 'ser' y 'estar'. 'Ser' se usa para caracter칤sticas permanentes, como 'soy alto', mientras que 'estar' se usa para estados temporales, como 'estoy cansado'. 쯊e ayudo con m치s ejemplos?";
            } else {
                return "Interesante pregunta sobre el aprendizaje de espa침ol. Para mejorar en el idioma es importante practicar regularmente, escuchar hablantes nativos y no tener miedo a cometer errores. 쮿ay alg칰n aspecto espec칤fico del espa침ol que te gustar칤a explorar?";
            }
        }
        
        // Funci칩n para convertir texto a voz
        function speakResponse(text) {
            if (!synthesis) {
                showError("La s칤ntesis de voz no est치 disponible");
                return;
            }
            
            // Cancelar cualquier reproducci칩n en curso
            synthesis.cancel();
            
            // Crear utterance
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'es-ES';
            utterance.rate = 0.9;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            
            // Eventos del utterance
            utterance.onstart = function() {
                status.textContent = "Respondiendo...";
                status.className = "status success";
            };
            
            utterance.onend = function() {
                status.textContent = "Presiona el cerebro para hacer otra pregunta";
                status.className = "status";
            };
            
            utterance.onerror = function(event) {
                showError("Error al reproducir la respuesta");
            };
            
            // Reproducir
            synthesis.speak(utterance);
        }
        
        // Funci칩n para mostrar errores
        function showError(message) {
            status.textContent = message;
            status.className = "status error";
        }
    </script>
</body>
</html>
