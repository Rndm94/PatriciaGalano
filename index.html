<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutor de Espa침ol con Gemini</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        .container {
            text-align: center;
            position: relative;
        }

        .brain-button {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(145deg, #8e2de2, #4a00e0);
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 90px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            user-select: none;
            position: relative;
            z-index: 10;
        }

        .brain-button:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        .brain-button:active {
            transform: scale(0.98);
        }

        .listening {
            animation: pulse 0.3s infinite alternate;
            background: linear-gradient(145deg, #ff416c, #ff4b2b);
        }

        @keyframes pulse {
            from {
                transform: scale(1);
                box-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
            }
            to {
                transform: scale(1.15);
                box-shadow: 0 0 50px rgba(255, 255, 255, 1);
            }
        }

        .status {
            margin-top: 40px;
            color: white;
            font-size: 22px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
            min-height: 30px;
            font-weight: 500;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px 20px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
        }

        .waves {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: wave 2s infinite;
            pointer-events: none;
        }

        .waves.listening {
            display: block;
        }

        @keyframes wave {
            0% {
                width: 250px;
                height: 250px;
                opacity: 1;
            }
            100% {
                width: 400px;
                height: 400px;
                opacity: 0;
            }
        }

        .footer {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
        }

        .hidden {
            display: none;
        }

        .error {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }

        .success {
            color: #51cf66;
            background: rgba(81, 207, 102, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="brain-button" id="brainButton">游</button>
        <div class="waves" id="waves"></div>
        <div class="status" id="status">Presiona el cerebro para hablar</div>
    </div>
    
    <div class="footer">
        Tutor de Espa침ol - Desarrollado por Rafael
    </div>

    <script>
        // Elementos del DOM
        const brainButton = document.getElementById('brainButton');
        const status = document.getElementById('status');
        const waves = document.getElementById('waves');
        
        // Variables globales
        const API_KEY = "AIzaSyAjt15fLEcxsXkGeZjBpu0BHKOt1HI6Gxs";
        let recognition = null;
        let synthesis = null;
        let isListening = false;
        
        // Inicializaci칩n
        document.addEventListener('DOMContentLoaded', function() {
            initializeSpeechRecognition();
            initializeSpeechSynthesis();
        });
        
        // Configurar reconocimiento de voz
        function initializeSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showError("Tu navegador no soporta reconocimiento de voz");
                brainButton.disabled = true;
                return;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            // Configuraci칩n mejorada
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'es-ES';
            recognition.maxAlternatives = 1;
            
            // Eventos
            recognition.onstart = function() {
                isListening = true;
                status.textContent = "Escuchando... habla ahora";
                status.className = "status success";
                brainButton.classList.add('listening');
                waves.style.display = 'block';
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                status.textContent = `Pregunta: "${transcript}"`;
                brainButton.classList.remove('listening');
                waves.style.display = 'none';
                
                // Enviar a Gemini
                sendToGemini(transcript);
            };
            
            recognition.onerror = function(event) {
                isListening = false;
                brainButton.classList.remove('listening');
                waves.style.display = 'none';
                
                let errorMessage = "Error de reconocimiento: ";
                switch(event.error) {
                    case 'no-speech':
                        errorMessage = "No se detect칩 voz. Intenta de nuevo.";
                        break;
                    case 'audio-capture':
                        errorMessage = "No se pudo acceder al micr칩fono.";
                        break;
                    case 'not-allowed':
                        errorMessage = "Permiso de micr칩fono denegado.";
                        break;
                    default:
                        errorMessage = "Error: " + event.error;
                }
                
                showError(errorMessage);
                setTimeout(() => {
                    status.textContent = "Presiona el cerebro para hablar";
                    status.className = "status";
                }, 3000);
            };
            
            recognition.onend = function() {
                isListening = false;
                brainButton.classList.remove('listening');
                waves.style.display = 'none';
                
                if (status.textContent === "Escuchando... habla ahora") {
                    status.textContent = "No se detect칩 voz. Intenta de nuevo.";
                    status.className = "status error";
                    setTimeout(() => {
                        status.textContent = "Presiona el cerebro para hablar";
                        status.className = "status";
                    }, 3000);
                }
            };
        }
        
        // Configurar s칤ntesis de voz
        function initializeSpeechSynthesis() {
            if (!('speechSynthesis' in window)) {
                showError("Tu navegador no soporta s칤ntesis de voz");
                return;
            }
            
            synthesis = window.speechSynthesis;
        }
        
        // Event Listener para el bot칩n
        brainButton.addEventListener('click', function() {
            if (!recognition) {
                showError("Reconocimiento de voz no disponible");
                return;
            }
            
            if (isListening) {
                recognition.stop();
                return;
            }
            
            try {
                recognition.start();
            } catch (error) {
                showError("Error al iniciar reconocimiento: " + error.message);
            }
        });
        
        // Funci칩n para enviar consulta a Gemini
        async function sendToGemini(query) {
            status.textContent = "Procesando tu pregunta...";
            status.className = "status";
            
            try {
                const response = await callGeminiAPI(query);
                speakResponse(response);
                
            } catch (error) {
                let errorMessage;
                
                if (error.message.includes("cr칠ditos")) {
                    errorMessage = "Los cr칠ditos de uso se han agotado, contacta a Rafael para arreglarlo";
                } else {
                    errorMessage = "Error al conectar con Gemini";
                }
                
                showError(errorMessage);
                speakResponse(errorMessage);
            }
        }
        
        // Funci칩n para llamar a la API de Gemini (simulada)
        async function callGeminiAPI(query) {
            // Simulamos un retardo de red
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Verificar si la consulta est치 relacionada con el aprendizaje de espa침ol
            const spanishLearningKeywords = [
                'espa침ol', 'espanol', 'aprender', 'idioma', 'lengua', 'gram치tica', 'gramatica',
                'vocabulario', 'verbos', 'conjugaci칩n', 'conjugacion', 'pronunciaci칩n', 'pronunciacion',
                'ejercicio', 'pr치ctica', 'practica', 'lecci칩n', 'leccion', 'clase', 'profesor',
                'tutor', 'ense침ar', 'ensenar', 'traducir', 'traducci칩n', 'traduccion', 'palabra',
                'frase', 'oraci칩n', 'oracion', 'conversaci칩n', 'conversacion', 'hablar', 'escuchar',
                'leer', 'escribir', 'ejemplo', 'regla', 'explicaci칩n', 'explicacion', 'significado'
            ];
            
            const lowerQuery = query.toLowerCase();
            const isRelatedToSpanish = spanishLearningKeywords.some(keyword => 
                lowerQuery.includes(keyword)
            );
            
            if (!isRelatedToSpanish) {
                return "Soy un tutor de espa침ol. Haz preguntas sobre el idioma.";
            }
            
            // Respuestas concisas seg칰n el tipo de pregunta
            if (lowerQuery.includes('hola')) {
                return "Hola. 쮼n qu칠 puedo ayudarte con el espa침ol?";
            } else if (lowerQuery.includes('verbo') && lowerQuery.includes('ser')) {
                return "Ser: soy, eres, es, somos, sois, son.";
            } else if (lowerQuery.includes('verbo') && lowerQuery.includes('estar')) {
                return "Estar: estoy, est치s, est치, estamos, est치is, est치n.";
            } else if (lowerQuery.includes('verbo') && lowerQuery.includes('tener')) {
                return "Tener: tengo, tienes, tiene, tenemos, ten칠is, tienen.";
            } else if (lowerQuery.includes('diferencia') && lowerQuery.includes('ser') && lowerQuery.includes('estar')) {
                return "Ser: caracter칤sticas permanentes. Estar: estados temporales.";
            } else if (lowerQuery.includes('g칠nero')) {
                return "En espa침ol, los sustantivos tienen g칠nero masculino o femenino.";
            } else if (lowerQuery.includes('n칰mero')) {
                return "Los sustantivos tienen n칰mero singular o plural.";
            } else if (lowerQuery.includes('art칤culo')) {
                return "Art칤culos: el, la, los, las (definidos), un, una, unos, unas (indefinidos).";
            } else if (lowerQuery.includes('adjetivo')) {
                return "Los adjetivos concuerdan en g칠nero y n칰mero con el sustantivo.";
            } else if (lowerQuery.includes('pronunciaci칩n')) {
                return "La pronunciaci칩n espa침ola es fon칠tica. Cada letra tiene un sonido.";
            } else if (lowerQuery.includes('acento')) {
                return "El acento ortogr치fico (췂) marca la s칤laba t칩nica en algunas palabras.";
            } else {
                return "Pregunta espec칤fica sobre espa침ol para respuesta concreta.";
            }
        }
        
        // Funci칩n para convertir texto a voz
        function speakResponse(text) {
            if (!synthesis) {
                showError("La s칤ntesis de voz no est치 disponible");
                return;
            }
            
            // Cancelar cualquier reproducci칩n en curso
            synthesis.cancel();
            
            // Crear utterance
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'es-ES';
            utterance.rate = 0.9;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            
            // Eventos del utterance
            utterance.onstart = function() {
                status.textContent = "Respondiendo...";
                status.className = "status success";
            };
            
            utterance.onend = function() {
                status.textContent = "Presiona el cerebro para hacer otra pregunta";
                status.className = "status";
            };
            
            utterance.onerror = function(event) {
                showError("Error al reproducir la respuesta");
            };
            
            // Reproducir
            synthesis.speak(utterance);
        }
        
        // Funci칩n para mostrar errores
        function showError(message) {
            status.textContent = message;
            status.className = "status error";
        }
    </script>
</body>
</html>
